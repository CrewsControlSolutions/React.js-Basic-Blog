{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nfunction fromStorage(value) {\n  return value !== null ? JSON.parse(value) : null;\n}\n\nfunction readItem(storage, key) {\n  try {\n    var storedValue = storage.getItem(key);\n    return fromStorage(storedValue);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction toStorage(value) {\n  return JSON.stringify(value);\n}\n\nfunction writeItem(storage, key, value) {\n  try {\n    if (value !== null) {\n      storage.setItem(key, toStorage(value));\n    } else {\n      storage.removeItem(key);\n    }\n\n    return Promise.resolve();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n}\n\nfunction useInitialState(storage, key, defaultState) {\n  var defaultStateRef = react_1.useRef(defaultState);\n  return react_1.useMemo(function () {\n    var _a;\n\n    return (_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current;\n  }, [key, storage]);\n}\n\nexports.useInitialState = useInitialState;\n\nfunction useStorageWriter(storage, key, state) {\n  var _a = react_1.useState(undefined),\n      writeError = _a[0],\n      setWriteError = _a[1];\n\n  react_1.useEffect(function () {\n    writeItem(storage, key, state).catch(function (error) {\n      if (!error || !error.message || error.message !== (writeError === null || writeError === void 0 ? void 0 : writeError.message)) {\n        setWriteError(error);\n      }\n    });\n\n    if (writeError) {\n      return function () {\n        setWriteError(undefined);\n      };\n    }\n  }, [state, key, writeError, storage]);\n  return writeError;\n}\n\nexports.useStorageWriter = useStorageWriter;\n\nfunction useStorageListener(storage, key, defaultState, onChange) {\n  var defaultStateRef = react_1.useRef(defaultState);\n  var onChangeRef = react_1.useRef(onChange);\n  var firstRun = react_1.useRef(true);\n  react_1.useEffect(function () {\n    var _a;\n\n    if (firstRun.current) {\n      firstRun.current = false;\n      return;\n    }\n\n    onChangeRef.current((_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n  }, [key, storage]);\n  react_1.useEffect(function () {\n    function onStorageChange(event) {\n      var _a;\n\n      if (event.key === key) {\n        onChangeRef.current((_a = fromStorage(event.newValue)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n      }\n    }\n\n    if (typeof window !== 'undefined') {\n      window.addEventListener('storage', onStorageChange);\n      return function () {\n        window.removeEventListener('storage', onStorageChange);\n      };\n    }\n  }, [key]);\n}\n\nexports.useStorageListener = useStorageListener;","map":{"version":3,"mappings":"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","names":["fromStorage","value","JSON","parse","readItem","storage","key","storedValue","getItem","e","toStorage","stringify","writeItem","setItem","removeItem","Promise","resolve","error","reject","useInitialState","defaultState","defaultStateRef","react_1","_a","current","exports","useStorageWriter","state","writeError","setWriteError","catch","message","undefined","useStorageListener","onChange","onChangeRef","firstRun","onStorageChange","event","newValue","window","addEventListener","removeEventListener"],"sourceRoot":"","sources":["../src/common.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}